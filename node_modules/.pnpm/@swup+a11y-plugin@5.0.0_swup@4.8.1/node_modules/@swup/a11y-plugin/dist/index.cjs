var t=require("@swup/plugin");require("focus-options-polyfill");var e=require("swup");function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=/*#__PURE__*/n(t);function i(t,e){return Object.keys(e).reduce((t,n)=>t.replace(`{${n}}`,e[n]||""),t||"")}class s{constructor(){this.id="swup-announcer",this.style="position:absolute;top:0;left:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;word-wrap:normal;width:1px;height:1px;",this.region=void 0,this.region=this.getRegion()??this.createRegion()}getRegion(){return document.getElementById(this.id)}createRegion(){const t=function(t){const e=document.createElement("template");return e.innerHTML=t,e.content.children[0]}(`<p aria-live="assertive" aria-atomic="true" id="${this.id}" style="${this.style}"></p>`);return document.body.appendChild(t),t}announce(t,e=0){return new Promise(n=>{setTimeout(()=>{this.region.textContent===t&&(t=`${t}.`),this.region.textContent="",this.region.textContent=t,n()},e)})}}function r(t){let e;if(e="string"==typeof t?document.querySelector(t):t,!(e instanceof HTMLElement))return;const n=e.getAttribute("tabindex");e.setAttribute("tabindex","-1"),e.focus({preventScroll:!0}),null!==n&&e.setAttribute("tabindex",n)}module.exports=class extends o.default{constructor(t={}){super(),this.name="SwupA11yPlugin",this.requires={swup:">=4"},this.defaults={headingSelector:"h1",respectReducedMotion:!0,autofocus:!1,announcements:{visit:"Navigated to: {title}",url:"New page at {url}"}},this.options=void 0,this.announcer=void 0,this.announcementDelay=100,this.rootSelector="body",this.handleAnchorScroll=(t,{hash:e})=>{const n=this.swup.getAnchorElement(e);n instanceof HTMLElement&&r(n)},this.options={...this.defaults,...t},this.announcer=new s}mount(){this.swup.hooks.create("content:announce"),this.swup.hooks.create("content:focus"),this.before("visit:start",this.prepareVisit),this.on("visit:start",this.markAsBusy),this.on("visit:end",this.unmarkAsBusy),this.on("visit:end",this.focusContent),this.on("visit:end",this.announceContent),this.on("scroll:anchor",this.handleAnchorScroll),this.before("visit:start",this.disableAnimations),this.before("link:self",this.disableAnimations),this.before("link:anchor",this.disableAnimations),this.swup.announce=this.announce.bind(this)}unmount(){this.swup.announce=void 0}announce(t){try{return Promise.resolve(this.announcer.announce(t)).then(function(){})}catch(t){return Promise.reject(t)}}markAsBusy(){document.documentElement.setAttribute("aria-busy","true")}unmarkAsBusy(){document.documentElement.removeAttribute("aria-busy")}prepareVisit(t){t.a11y={announce:void 0,focus:this.rootSelector}}announceContent(t){this.swup.hooks.callSync("content:announce",t,void 0,t=>{void 0===t.a11y.announce&&(t.a11y.announce=this.getPageAnnouncement()),t.a11y.announce&&this.announcer.announce(t.a11y.announce,this.announcementDelay)})}focusContent(t){this.swup.hooks.callSync("content:focus",t,void 0,t=>{t.a11y.focus&&(this.options.autofocus&&!0===function(){const t=function(){const t=document.querySelector("body [autofocus]");if(t&&!t.closest('[inert], [aria-disabled], [aria-hidden="true"]'))return t}();return!!t&&(t!==document.activeElement&&t.focus(),!0)}()||r(t.a11y.focus))})}getPageAnnouncement(){const{headingSelector:t,announcements:n}=this.options;return function({headingSelector:t="h1",announcements:n={}}){const o=document.documentElement.lang||"*",{href:s,url:r,pathname:u}=e.Location.fromUrl(window.location.href),a=n[o]??n["*"]??n;if("object"!=typeof a)return;const c=document.querySelector(t);c||console.warn(`SwupA11yPlugin: No main heading (${t}) found on new page`);const h=c?.getAttribute("aria-label")||c?.textContent||document.title||i(a.url,{href:s,url:r,path:u});return i(a.visit,{title:h,href:s,url:r,path:u})}({headingSelector:t,announcements:n})}disableAnimations(t){this.options.respectReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(t.animation.animate=!1,t.scroll.animate=!1)}};
//# sourceMappingURL=index.cjs.map
