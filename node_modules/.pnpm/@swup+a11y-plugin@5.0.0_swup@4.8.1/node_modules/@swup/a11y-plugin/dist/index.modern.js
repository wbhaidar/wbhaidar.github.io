import t from"@swup/plugin";import"focus-options-polyfill";import{Location as n}from"swup";function e(){return e=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},e.apply(this,arguments)}function o(t,n){return Object.keys(n).reduce((t,e)=>t.replace(`{${e}}`,n[e]||""),t||"")}class i{constructor(){var t;this.id="swup-announcer",this.style="position:absolute;top:0;left:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;word-wrap:normal;width:1px;height:1px;",this.region=void 0,this.region=null!=(t=this.getRegion())?t:this.createRegion()}getRegion(){return document.getElementById(this.id)}createRegion(){const t=function(t){const n=document.createElement("template");return n.innerHTML=t,n.content.children[0]}(`<p aria-live="assertive" aria-atomic="true" id="${this.id}" style="${this.style}"></p>`);return document.body.appendChild(t),t}announce(t,n=0){return new Promise(e=>{setTimeout(()=>{this.region.textContent===t&&(t=`${t}.`),this.region.textContent="",this.region.textContent=t,e()},n)})}}function s(t){let n;if(n="string"==typeof t?document.querySelector(t):t,!(n instanceof HTMLElement))return;const e=n.getAttribute("tabindex");n.setAttribute("tabindex","-1"),n.focus({preventScroll:!0}),null!==e&&n.setAttribute("tabindex",e)}class r extends t{constructor(t={}){super(),this.name="SwupA11yPlugin",this.requires={swup:">=4"},this.defaults={headingSelector:"h1",respectReducedMotion:!0,autofocus:!1,announcements:{visit:"Navigated to: {title}",url:"New page at {url}"}},this.options=void 0,this.announcer=void 0,this.announcementDelay=100,this.rootSelector="body",this.handleAnchorScroll=(t,{hash:n})=>{const e=this.swup.getAnchorElement(n);e instanceof HTMLElement&&s(e)},this.options=e({},this.defaults,t),this.announcer=new i}mount(){this.swup.hooks.create("content:announce"),this.swup.hooks.create("content:focus"),this.before("visit:start",this.prepareVisit),this.on("visit:start",this.markAsBusy),this.on("visit:end",this.unmarkAsBusy),this.on("visit:end",this.focusContent),this.on("visit:end",this.announceContent),this.on("scroll:anchor",this.handleAnchorScroll),this.before("visit:start",this.disableAnimations),this.before("link:self",this.disableAnimations),this.before("link:anchor",this.disableAnimations),this.swup.announce=this.announce.bind(this)}unmount(){this.swup.announce=void 0}async announce(t){await this.announcer.announce(t)}markAsBusy(){document.documentElement.setAttribute("aria-busy","true")}unmarkAsBusy(){document.documentElement.removeAttribute("aria-busy")}prepareVisit(t){t.a11y={announce:void 0,focus:this.rootSelector}}announceContent(t){this.swup.hooks.callSync("content:announce",t,void 0,t=>{void 0===t.a11y.announce&&(t.a11y.announce=this.getPageAnnouncement()),t.a11y.announce&&this.announcer.announce(t.a11y.announce,this.announcementDelay)})}focusContent(t){this.swup.hooks.callSync("content:focus",t,void 0,t=>{t.a11y.focus&&(this.options.autofocus&&!0===function(){const t=function(){const t=document.querySelector("body [autofocus]");if(t&&!t.closest('[inert], [aria-disabled], [aria-hidden="true"]'))return t}();return!!t&&(t!==document.activeElement&&t.focus(),!0)}()||s(t.a11y.focus))})}getPageAnnouncement(){const{headingSelector:t,announcements:e}=this.options;return function({headingSelector:t="h1",announcements:e={}}){var i,s;const r=document.documentElement.lang||"*",{href:a,url:u,pathname:c}=n.fromUrl(window.location.href),l=null!=(i=null!=(s=e[r])?s:e["*"])?i:e;if("object"!=typeof l)return;const h=document.querySelector(t);h||console.warn(`SwupA11yPlugin: No main heading (${t}) found on new page`);const d=(null==h?void 0:h.getAttribute("aria-label"))||(null==h?void 0:h.textContent)||document.title||o(l.url,{href:a,url:u,path:c});return o(l.visit,{title:d,href:a,url:u,path:c})}({headingSelector:t,announcements:e})}disableAnimations(t){this.options.respectReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(t.animation.animate=!1,t.scroll.animate=!1)}}export{r as default};
//# sourceMappingURL=index.modern.js.map
