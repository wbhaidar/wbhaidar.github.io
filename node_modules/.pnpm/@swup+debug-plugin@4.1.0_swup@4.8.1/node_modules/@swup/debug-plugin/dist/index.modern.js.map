{"version":3,"file":"index.modern.js","sources":["../src/index.ts"],"sourcesContent":["import Plugin from '@swup/plugin';\nimport { query, queryAll } from 'swup';\nimport type { Swup, HookName, HookArguments } from 'swup';\n\ndeclare global {\n\tinterface Window {\n\t\tswup?: Swup;\n\t}\n}\n\ntype Options = {\n\tglobalInstance: boolean;\n};\n\nexport default class SwupDebugPlugin extends Plugin {\n\tname = 'SwupDebugPlugin';\n\n\trequires = { swup: '>=4' };\n\n\tdefaults: Options = {\n\t\tglobalInstance: false\n\t};\n\toptions: Options;\n\toriginalSwupLog?: Swup['log'];\n\toriginalSwupHookCall?: Swup['hooks']['call'];\n\toriginalSwupHookCallSync?: Swup['hooks']['callSync'];\n\n\tconstructor(options = {}) {\n\t\tsuper();\n\t\tthis.options = { ...this.defaults, ...options };\n\t}\n\n\tmount() {\n\t\t// set non-empty log method of swup\n\t\tthis.setLogImplementation();\n\n\t\t// set swup instance as a global variable swup\n\t\tthis.setGlobalInstance();\n\n\t\t// make hook calls appear in console\n\t\tthis.proxyHooksThroughConsole();\n\n\t\t// check if title tag is present\n\t\tthis.checkDocumentTitle();\n\n\t\t// check if all containers are present\n\t\tthis.checkContainers();\n\n\t\t// check if transition classes map to containers\n\t\tthis.checkAnimationSelector();\n\t}\n\n\tunmount() {\n\t\tsuper.unmount();\n\n\t\tthis.restoreLogImplementation();\n\t\tthis.restoreHooksImplementation();\n\t\tthis.unsetGlobalInstance();\n\t}\n\n\tsetLogImplementation() {\n\t\tthis.originalSwupLog = this.swup.log;\n\t\tthis.swup.log = this.log;\n\t}\n\n\trestoreLogImplementation() {\n\t\tthis.swup.log = this.originalSwupLog!;\n\t}\n\n\tproxyHooksThroughConsole() {\n\t\tthis.originalSwupHookCall = this.swup.hooks.call.bind(this.swup.hooks);\n\t\tthis.originalSwupHookCallSync = this.swup.hooks.callSync.bind(this.swup.hooks);\n\t\tthis.swup.hooks.call = this.callHook.bind(this);\n\t\tthis.swup.hooks.callSync = this.callHookSync.bind(this);\n\t}\n\n\trestoreHooksImplementation() {\n\t\tthis.swup.hooks.call = this.originalSwupHookCall!;\n\t\tthis.swup.hooks.callSync = this.originalSwupHookCallSync!;\n\t}\n\n\tsetGlobalInstance() {\n\t\tif (this.options.globalInstance) {\n\t\t\twindow.swup = this.swup;\n\t\t}\n\t}\n\n\tunsetGlobalInstance() {\n\t\tif (this.options.globalInstance) {\n\t\t\twindow.swup = undefined;\n\t\t}\n\t}\n\n\tcheckDocumentTitle() {\n\t\tif (!query('title')) {\n\t\t\tthis.error('Document is missing a title tag. It is required on every page.');\n\t\t}\n\t}\n\n\tcheckContainers() {\n\t\tfor (const selector of this.swup.options.containers) {\n\t\t\tconst containers = queryAll(selector);\n\t\t\tif (!containers.length) {\n\t\t\t\tthis.error(`Container \\`${selector}\\` is missing on the page.`);\n\t\t\t}\n\t\t\tif (containers.length > 1) {\n\t\t\t\tthis.error(`Container \\`${selector}\\` matches multiple elements.`);\n\t\t\t}\n\t\t\tif (containers.some((container) => !container.matches('body *'))) {\n\t\t\t\tthis.error(`Container \\`${selector}\\` is not supported. It must be a child of the body tag.`);\n\t\t\t}\n\t\t}\n\t}\n\n\tcheckAnimationSelector() {\n\t\tconst { animationSelector } = this.swup.options;\n\t\tif (!animationSelector) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst containers = this.swup.options.containers.map((selector) => query(selector));\n\t\tconst animatedContainers = containers.filter((el) => el?.matches(animationSelector));\n\t\tif (!animatedContainers.length) {\n\t\t\tthis.warn(`No container matches the animation selector \\`${animationSelector}\\`.`);\n\t\t}\n\t}\n\n\tlogHook<T extends HookName>(hook: T, args: HookArguments<T>) {\n\t\tconsole.groupCollapsed('%cswup:' + '%c' + hook, 'color: #343434', 'color: #009ACD');\n\t\tconsole.log(args);\n\t\tconsole.groupEnd();\n\t}\n\n\tcallHook: Swup['hooks']['call'] = (hook, args, ...rest) => {\n\t\tthis.logHook(hook, args);\n\t\treturn this.originalSwupHookCall!(hook, args, ...rest);\n\t};\n\n\tcallHookSync: Swup['hooks']['callSync'] = (hook, args, ...rest) => {\n\t\tthis.logHook(hook, args);\n\t\treturn this.originalSwupHookCallSync!(hook, args, ...rest);\n\t};\n\n\tlog(str: string, object: any): void {\n\t\tif (object) {\n\t\t\tconsole.groupCollapsed(str);\n\t\t\tfor (let key in object) {\n\t\t\t\tconsole.log(object[key]);\n\t\t\t}\n\t\t\tconsole.groupEnd();\n\t\t} else {\n\t\t\tconsole.log(str + '%c', 'color: #009ACD');\n\t\t}\n\t}\n\n\twarn(str: string): void {\n\t\tconsole.warn(`[swup debug plugin] ${str}`);\n\t}\n\n\terror(str: string): void {\n\t\tconsole.error(`[swup debug plugin] ${str}`);\n\t}\n}\n"],"names":["SwupDebugPlugin","Plugin","constructor","options","super","this","name","requires","swup","defaults","globalInstance","originalSwupLog","originalSwupHookCall","originalSwupHookCallSync","callHook","hook","args","rest","logHook","callHookSync","_extends","mount","setLogImplementation","setGlobalInstance","proxyHooksThroughConsole","checkDocumentTitle","checkContainers","checkAnimationSelector","unmount","restoreLogImplementation","restoreHooksImplementation","unsetGlobalInstance","log","hooks","call","bind","callSync","window","undefined","query","error","selector","containers","queryAll","length","some","container","matches","animationSelector","map","filter","el","warn","console","groupCollapsed","groupEnd","str","object","key"],"mappings":"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"}