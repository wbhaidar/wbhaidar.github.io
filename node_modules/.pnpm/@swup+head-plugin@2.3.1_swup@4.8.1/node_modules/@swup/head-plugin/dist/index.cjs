function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=/*#__PURE__*/e(require("@swup/plugin"));function s(e){return"title"!==e.localName&&!e.matches("[data-swup-theme]")}function n(e,t){return e.outerHTML===t.outerHTML}function o(e,t=[]){const s=Array.from(e.attributes);return t.length?s.filter(({name:e})=>t.some(t=>t instanceof RegExp?t.test(e):e===t)):s}function r(e){return e.matches("link[rel=stylesheet][href]")}module.exports=class extends t.default{constructor(e={}){super();const t=this;this.name="SwupHeadPlugin",this.requires={swup:">=4.6"},this.defaults={persistTags:!1,persistAssets:!1,awaitAssets:!1,attributes:["lang","dir"],timeout:3e3},this.options=void 0,this.updateHead=function(e,{page:{}}){try{const{awaitAssets:i,attributes:u,timeout:a}=t.options,l=e.to.document,{removed:c,added:d}=function(e,t,{shouldPersist:o=()=>!1}={}){const r=Array.from(e.children),i=Array.from(t.children),u=(a=r,i.reduce((e,t,s)=>(a.some(e=>n(t,e))||e.push({el:t,index:s}),e),[]));var a;const l=function(e,t){return e.reduce((e,s)=>(t.some(e=>n(s,e))||e.push({el:s}),e),[])}(r,i);l.reverse().filter(({el:e})=>s(e)).filter(({el:e})=>!o(e)).forEach(({el:t})=>e.removeChild(t));const c=u.filter(({el:e})=>s(e)).map(t=>{let s=t.el.cloneNode(!0);return e.insertBefore(s,e.children[(t.index||0)+1]||null),{...t,el:s}});return{removed:l.map(({el:e})=>e),added:c.map(({el:e})=>e)}}(document.head,l.head,{shouldPersist:e=>t.isPersistentTag(e)});t.swup.log(`Removed ${c.length} / added ${d.length} tags in head`),u?.length&&function(e,t,s=[]){const n=new Set;for(const{name:r,value:i}of o(t,s))e.setAttribute(r,i),n.add(r);for(const{name:t}of o(e,s))n.has(t)||e.removeAttribute(t)}(document.documentElement,l.documentElement,u);const h=function(){if(i){const e=function(e,t=0){return e.filter(r).map(e=>function(e,t=0){let s;const n=t=>{e.sheet?t():s=setTimeout(()=>n(t),10)};return new Promise(o=>{n(()=>o(e)),t>0&&setTimeout(()=>{s&&clearTimeout(s),o(e)},t)})}(e,t))}(d,a),s=function(){if(e.length)return t.swup.log(`Waiting for ${e.length} assets to load`),Promise.resolve(Promise.all(e)).then(function(){})}();if(s&&s.then)return s.then(function(){})}}();return Promise.resolve(h&&h.then?h.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},this.options={...this.defaults,...e},this.options.persistAssets&&!this.options.persistTags&&(this.options.persistTags="link[rel=stylesheet], script[src], style")}mount(){this.before("content:replace",this.updateHead)}isPersistentTag(e){const{persistTags:t}=this.options;return"function"==typeof t?t(e):"string"==typeof t&&t.length>0?e.matches(t):Boolean(t)}};
//# sourceMappingURL=index.cjs.map
